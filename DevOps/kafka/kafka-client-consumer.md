# 카프카 컨슈머 kafka consumer
* 참고한 글 https://always-kimkim.tistory.com/entry/kafka101-consumer?category=876258


## 카프카 컨슈머
* 컨슈머는 consumerAPI와 그것으로 구성된 애플리케이션을 말한다.
* 컨슈머가 토픽 파티션에서 저장된 메시지를 받아오는 것을 구독(subscribe) 또는 읽는다(read)라고 한다.


#### 카프카 컨슈머의 특징
* polling 구조
* 단일 토픽의 멀티 컨슈밍
* 컨슈머 그룹


#### polling 구조
* 일반적인 메시징 큐는 메시지 큐에서 메시지를 push한다. 이 방식은 메시지를 보내고 나면 MQ(메시지 큐)에서 메시지가 삭제된다.
* 하지만 카프카는 polling 방식을 이용해 전송된 메시지가 사라지지 않고 남도록 한다. 이 방식의 가장 큰 장점은 멀티 컨슈밍이 가능하다는 점이다.
* 즉 하나의 토픽을 여러 컨슈머가 동시에 구독할 수 있고, 한 컨슈머가 여러 토픽을 구독할 수도 있다.


#### 단일 토픽의 멀티 컨슈밍 multi consuming
* polling 구조 덕분에 카프카는 단일 토픽의 멀티 컨슈밍이 가능하다.
* 구독 후 메시지가 삭제되지 않는 대신, 컨슈머는 각 어느 토픽 파티션의 어느 오프셋까지 읽어갔는 지를 consumer offset이라는 토픽에 저장한다.
* consumer offset의 또다른 장점으로는 메시지 구독 중 애플리케이션이 중단되었다가 다시 구동되는 경우 어디서부터 메시지를 읽어야 하는지 알 수 있다는 점이다. 따라서 컨슈머 상태와 관계 없이 안정적인 메시지 구독이 가능하다.


#### 컨슈머 그룹 consumer group
* consumer group은 카프카에서 하나 이상의 컨슈머가 그룹을 이룬 것이다.
* 브로커는 성능을 위해 하나의 토픽을 여러 파티션으로 병렬 구성하여 처리하는데, 둘 이상의 파티션을 하나의 컨슈머로만 처리한다면 성능 상의 문제가 발생할 수 있다. 따라서 컨슈커 그룹을 통해 문제를 해결한다.
* 같은 컨슈머 그룹 내의 컨슈머들은 토픽 파티션의 소유권(=구독권)을 나누어서 가져간다.
* 만약 컨슈머 그룹에 컨슈머가 추가되거나 제외되면 컨슈머 그룹 내부의 파티션 소유권을 재조정하게 되는데 이것을 rebalancing이라고 한다.
* 리밸런싱은 카프카의 컨슈머들이 유연하고 안정적으로 토픽을 구독할 수 있도록 도와준다.