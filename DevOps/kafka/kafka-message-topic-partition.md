# 카프카의 메시지, 토픽, 파티션 message, topic, partition
* 카프카 브로커는 producer ---> broker ---> consumer 의 흐름대로 메시지를 전달하는 역할을 담당한다.
* 카프카에서 전달되는 메시지가 뭔지, 그리고 여기에 관련된 토픽과 파티션이란 무엇인지 알아보자.
* 참고한 글  https://always-kimkim.tistory.com/entry/kafka101-message-topic-partition


## 카프카의 메시지 message
* 카프카의 메시지는 key, value로 구성된다.
* key
    * 메시지가 브로커 내부에 저장될 때 저장되는 위치와 관련된 요소
    * 프로듀서가 메시지를 브로커로 전달할 때 프로듀서 내부의 파티셔너가 저장 위치를 결정하게 되는데, 이 때 키의 값을 연산에 이용한다.
* value
    * 메시지가 전달하고자 하는 내용물을 의미한다.
    * 값은 단순한 문자열 또는 json같은 객체가 될 수도 있다.
    * 값의 타입이 다양할 수 있는 이유는 메시지가 전송될 때 직렬화/역직렬화를 거치기 때문이다.    
* 프로듀서가 메시지를 브로커로 전달할 때 프로듀서 내부의 파티셔너가 저장 위치를 결정하는데, 이때 키의 값을 이용하여 연산하고 그 결과에 따라 저장되는 위치를 결정합니다.


## 카프카의 토픽 topic / 논리적 단위
* 카프카의 토픽은 메시지를 구분하는 논리적인 단위이다.
* 동일한 토픽의 메시지들은 논리적으로 같은 문맥을 가진다.


## 카프카의 파티션 partition / 물리적 단위
* 하나의 카프카 토픽은 내부적으로 다시 카프카 파티션이라는 물리적인 기준으로 나뉜다.
    * 즉 모든 토픽은 각각에 대응하는 하나 이상의 파티션을 가진다.
    * 발행된 토픽 메시지들은 파티션들에 나뉘어 저장된다.
    * 이런 방식으로 카프카는 분산 처리를 통한 성능 향상, 즉 scale-out이 가능하다.
* 같은 파티션 내에서는 메시지 순서가 보장된다.
    * 파티션은 메시지 순서 보장의 단위로 볼 수도 있다.
    * 그러나 토픽 안에서 파티션 간의 순서는 보장되지 않는다.


#### 파티션 복제 replica
* 카프카에는 서비스 안정성과 장애 수용을 위해 파티션의 복제 기능이 있다.
* 하나의 파티션은 1개의 leader replica & 0개 이상의 follower replica로 구성된다.
* 한 파티션 내의 레플리카 수는 복제 계수replication factor를 통해 결정된다.
    * 복제 계수가 1이라면 파티션은 리더 레플리카로만 구성된다.
* 모든 레플리카들은 서로 다른 브로커에 구성된다.


##### 리더 레플리카 leader replica
* 파티션의 모든 쓰기, 읽기 작업을 담당한다.


##### 팔로어 레플리카 follower replica
* 리더 레플리카로 쓰인 메시지들을 그대로 복제하여 동기화한다.
* 동기화를 통해 리더에 장애가 발생하는 경우 리더 자리를 승계받을 준비를 한다.
* 이 때 승계받을 준비가 된 레플리카들의 그룹을 In-Sync Replica, 즉 ISR이라고 한다.

