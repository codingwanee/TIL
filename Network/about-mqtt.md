# IoT 프로토콜, MQTT
- Internet Of Things for architects (페리 레아, 에이콘 출판사)
- 9장의 내용 참고 - IOT 공간에서 주로 필요한 프로토콜에 대한 내용

## MOM 
- 메시지 지향 미들웨어 MOM, Message Orientated Middleware
- MOM은 메시지를 하나의 사용자-공간 애플리케이션에서 다른 애플리케이션으로 전달하는 역할
- MOM 프로토콜의 예) AMQP, MQTT, STOMP 등

#### MOM과 대기열
- MOM의 기본 개념은 두 장치 사이의 통신이 배포된 메시지 대기열을 사용해 이뤄진다는 것
- 어떤 장치는 대기열에 추가할 데이터를 생산하는 한편, 대기열에 저장된 데이터를 소비하는 장치도 있으며, 브로커나 중간자가 중앙 서비스로 존재해야 하는 구축도 있음
- 이 경우, 생산자와 소비자는 브로커와 발행-구독 유형의 관계를 맺게 됨
- 대기열을 활용하면 서버에 오류가 생기더라도 데이터를 대기열에 유지하는 것이 가능해, 설계상 회복력/탄력성을 확보할 목적으로 활용할 수 있음

#### MOM과 RESTful의 차이
- RESTful 설계는 전형적인 클라이언트-서버 아키텍처에 해당
- 클라이언트는 동기-요청 응답 패턴을 통해 자원에 액세스
- RESTful 설계에서는 자원의 통합 자원 식별자를 요청하는 데 GET, PUT, POST, DELETE와 같은 HTTP 방식을 사용
- 이 아키텍처에서는 브로커나 중간 에이전트가 따로 필요하지 않음.
- HTTP 스택에 기반하고 있으므로 HTTPS 보안과 같이 제공되는 대부분의 서비스를 이용할 수 있음


## MQTT
- IBM 웹스피어 메시지 큐 (Websphere Message Queue) 기술은 1993년 독립된 비병핸 분산 시스템의 안전한 통신이라는 문제를 처리하기 위해 처음으로 개념화 됨
- MQTT는 웹스피어MQ의 파생으로, 원격지의 원유 및 가스 파이프라인을 위성을 통해 연결하는 데 활용하기 위해 1999년 IBM의 앤디 스탠포드 클라크와 아를렌 니퍼에 의해 만들어짐

#### MQTT 기반 전송 프로토콜의 목표
- 구축이 간단할 것
- 서비스 품질 형식을 제공할 것
- 초경량이면서도 대역폭을 효율적으로 활용할 것
- 데이터에 종속되지 않을 것
- 지속적으로 세션을 인지할 것
- 보안 문제를 처리할 것


#### MQTT sub/pub
- pub/sub 으로도 알려진 발행-구독 모델은 메시지를 수신하는 클라이언트와 메시지를 송신하는 클라이언트를 분리하는 한가지 방식이다.
- 기존의 클라이언트-서버 모델과 달리, 여기에서 클라이언트느 IP 주소나 포트와 같은 물리적 식별자를 인식하지 않는다.
- MQTT는 pub/sub 아키텍처이긴 하지만 메시지 큐는 아니다.
- 메시지 큐는 메시지를 저장하기 마련인 반면, MQTTsms aptlwlfmf wjwkdgkwlsms dksgsmsek.
- MQTT에서 특정 토픽을 아무도 구독하지 않을 경우, 해당 토픽은 무시도니 후 사라진다.
- 메시지 대기열은 한 명의 소비자가 한 명의 생산자와 싸응로 묶여 있을 경우 클라이언트-서버 토폴로지를 유지한다.

#### sub/pub 구조의 각 역할
- 발행자 publisher : 메시지를 전송하는 클라이언트
- 구독자 subscriber : 메시지를 수신하는 클라이언트
- 브로커 broker : 클라이언트끼리 연결하고 데이터를 필터링하는 일을 담당, 중심적 역할

#### 브로커의 필터링
- 제목 필터링 subject filtering
    - 설계상 클라이언트는 여러 토픽을 구도ㅓㄱ하고, 특정 토픽이 나뉘면 원하는 데이터 이외에는 수신하지 않게 된다.
    - 발행된 각각의 메시지는 토픽을 반드시 포함해야 하며, 브로커는 이 메시지를 구독 중인 클라이언트로 다시 브로드캐스팅하거나 무시하는 역할 담당

- 콘텐츠 필터링 content filtering
    - 중개자는 발행된 데이터를 탐색하고 필터링
    - 따라서 암호화되지 않은 모든 데이터는 저장되거나 다른 클라이언트에 발행되기 전에 브로커가 관리 가능

- 유형 필터링 type filtering
    - 구독 중인 데이터 스트림을 수신하는 클라이언트는 자체 필터도 적용할 수 있음
    - 수신 데이터는 구문 분석을 거치게 되며, 해당 데이터 스트림을 추가로 처리하거나 무시


