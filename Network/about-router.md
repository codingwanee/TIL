# 라우팅 route

## 라우팅의 개념
* 라우터가 데이터의 목적지가 어느 네트워크에 접속해 있는지 판단해서 연결된 네트워크의 라우터로 전송해주는 행위를 라우팅이라고 한다.
* 라우팅을 계속 반복하면 멀리 떨어진 네트워크까지도 데이터를 전송할 수 있다.

## 라우터와 네트워크 연결

* '네트워크에 접속한다'는 것은 'IP 주소를 설정한다'는 것과 마찬가지다. 라우터로 복수의 네트워크를 연결할 때도 IP주소를 설정한다.
* 라우터로 네트워크를 서로 연결할 때, 라우터에는 복수의 인터페이스가 준비되어 있으므로 물리적 배선에 더해 IP 주소를 각각 설정해야 한다.



## 라우터와 데이터

#### 0. 라우터의 데이터 전송
* 라우터가 전송하는 데이터는 IP 패킷이다.
* IP 패킷은 TCP/IP 계층에서 인터넷층에 속하므로 라우팅 동작은 인터넷층에서 하게 된다.
* IP 헤더
    1. 라우터는 데이터를 전송할 때 IP 헤더 안에 있는 목적지 IP 주소를 확인한다.
    2. IP 헤더의 TTL과 헤더 체크섬만 변경되며, 나머지 부분은 변경되지 않은 채로 전송된다.
    3. 이더넷 헤더 등 네트워크 인터페이스층 프로토콜의 헤더는 라우터가 전송할 때 완전히 새로운 헤더로 교체된다.

#### 1. 라우터의 데이터 전송처 결정
1. 라우팅 대상인 IP 패킷을 수신한다.
    * 라우터가 라우팅하는 대상인 IP 패킷은 다음과 같이 이루어져 있다.
        - 목적지 레이어2 주소(MAC 주소) : 라우터
        - 목적지 IP 주소 : 라우터의 IP 주소 이외
2. 목적지 IP 주소로 경로 정보를 검색해서 전송할 곳을 결정한다.
    * 목적지 IP 주소로 라우팅 테이블 상의 경로 정보를 검색해 전송할 곳을 결정한다.    


#### 2. 다음 라우터로 데이터를 전송
* 경로 정보 검색이 끝나면 넥스트홉(다음 전송지)에 실제로 데이터를 전송한다.
* 목적지에 데이터를 전송하려면 이더넷 헤더를 추가해야 한다. 그러기 위해서는 목적지의 MAC 주소가 필요하다.
* MAC 주소를 구하는 데는 ARP(IP 주소로 MAC 주소를 구하는 프로토콜)를 실행해야 한다.
* 넥스트홉으로 데이터 전송하는 순서
    1. ARP 실행해서 목적지 MAC 주소 구하기
    2. 새로운 이더넷 헤더로 바꾼 후 IP 패킷을 전송한다.
        * 라우터에서 NAT로 IP주소를 변환하지 않는 이상 단순히 라우팅할 때 IP 주소는 변하지 않는다.


#### 3. 최종 주소 확인
* R1에서 전송된 IP 패킷은 R2에서 수신한다.
* 수신한 라우터가 최종목적지가 아니라면 다시 2의 과정으로 새로운 목적지에 데이터를 전송한다.


#### 4. 최종 목적지로 데이터 전송
1. 다시 ARP를 실행해 목적지의 MAC 주소를 구한다.
2. 새로운 이더넷 헤더를 추가하고 IP 패킷을 전송한다.
    * 이 때 MAC 주소는 처음과 달라지지만 IP 주소는 같다.