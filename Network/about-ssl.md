# 생활코딩 - 서버 내용정리

## 도메인(domain)
* ip는 사람이 이해하고 기억하기 어렵기 때문에 이를 위해서 각 ip에 이름을 부여할 수 있게 했는데, 이것을 도메인이라고 한다.

#### 도메인의 구성요소
* 컴퓨터의 이름 + 최상위 도메인
    * ex) daum.co.kr
        * daum : 컴퓨터의 이름
        * co : 국가 형태의 최상위 도메인
        * kr : 대한민국의 NIC에서 관리하는 도메인
* URL : 도메인 + 경로



## 호스트(host)
* 네트워크에 연결되어 있는 컴퓨터들을 호스트라고 한다.

#### 호스트 설정이란?
* 도메인을 호스트의 IP에 연결하는 행위

#### 도메인과 호스트의 관계도
1. 내 컴퓨터 -- opentutorials.org --> 네임서버
2. 내 컴퓨터 <---- 115.68.24.88  ---- 네임서버
3. 내 컴퓨터 -----------------------> 115.68.24.88

* 네임서버 : 도메인에 해당하는 IP를 알려주는 서비스 제공



## 포워딩
* 도메인으로 접근한 사용자를 다른 도메인으로 보내는 행위

#### 호스팅 설정과 포워딩의 차이점
* 호스트 설정은 도메인과 IP를 연결시키는 것 --> URL 변경 없음
* 포워딩은 다른 도메인으로 보내는 것. --> URL이 변경됨



## hosts 파일

#### 브라우저가 도메인에 해당하는 IP를 찾는 순서
1. local cache를 검색
2. hosts 파일을 검색
3. 도메인 네임서버를 검색

#### hosts 파일의 위치
* OS에 따라 위치가 다름
- Unix
    - /etc/hosts
- Windows
    - %SystemRoot%\system32\drivers\etc\hosts
- Android
    - /system/etc/hosts
- iOS
    - /private/etc/hosts
- 등등...        



## 프로토콜

#### HTTP
* Hypertext Transfer Protocol
* 즉 Hypertextdls HTML을 전송하기 위한 통신규약
* HTTP는 암호화되지 않은 방법으로 데이터를 전송하기 때문에 서버와 클라리언트가 주고 받는 메시지를 감청하는 것이 쉬운 방식

#### HTTPS
* HTTP + Secure (Over Secure Socket Layer)
* 암호화되지 않은 방법으로 데이터를 주고받는 방식
* HTTPS는 SSL 프로토콜 위에서 돌아가는 프로토콜

#### SSL (= TLS)
* SSL은 네스케이프에 의해서 개발된 프로토콜로, 폭넓게 사용되다가 표준화 기구인 IETF가 추후에 TLS로 이름을 바꾸었다.
* 그러나 아직 SSL이라는 이름이 더욱 넓게 사용되고 있다.


## SSL

#### SSL 인증서
* 클라이언트와 서버간의 통신을 제3자가 보증해주는 전자화된 문서

* 동작하는 방식
    1. 클라이언트가 서버에 접속
    2. 접속직후 서버는 클라이언트에게 SSL 인증서 정보 전달
    3. 클라이언트는 인증서 정보가 신뢰할 수 있는 것인지를 검증한 후 업무 수행

* SSL 인증서를 이용하는 장점
    * 통신 내용이 공격자에게 노출되는 것을 막을 수 있음
    * 클라이언트가 접속하려는 서버가 신뢰할 수 있는 서비스인지 판단
    * 통신 내용의 악의적인 변경 방지





## SSL에서 사용하는 암호화의 종류
* SSL의 핵심은 암호화다
* 


#### 대칭키
* 주고받는 데이터를 암호화할 때 사용하는 키
* 대칭키를 모르면 복호화를 할 수 없음
* 대칭키가 유출되면 보안이 무너진다는 단점


#### 공개키
* A, B 두 개의 키를 가지고 A 암호화 B 복호화 반대의 역할을 수행하는 방식
* 두개의 키 중 하나를 개인키(private key), 나머지를 공개키(public key)로 지정
* 개인키는 자신만이 가지고 있고 공개키를 타인에게 제공
* 작동방식
    1. 송신자는 공개키로 정보 암호화
    2. 암호화 된 정보 전송
    3. 수신자는 개인키로 복호화

* 이 경우에도 만약 데이터가 유출되면 보안이 뚫릴 수 있음
* 그러나 공개키 방식은 데이터 보호가 목적이 아니라 데이터를 제공한 사람의 신원을 보장하는 것 ==> 전자서명



#### SSL 인증서
* SSL 인증서 매커니즘
1. 클라이언트가 접속한 서버가 신뢰할 수 있는 서버임을 보장
2. SSL 통신에 사용할 공개키를 클라이언트에게 제공


#### CA
* 인증서의 역할은 클라이언트가 접속한 서버가 클라이언트가 의도한 서버가 맞는지 보장하는 것
* 이 역할을 하는 민간기업들이 CA(Certificate authority) 혹은 Root Certificate
    - 대표적인 기업: Symantec, Comodo, GoDaddy, GlobalSign 등
* SSL을 통해서 암호화된 통신을 제공하려는 서비스는 CA를 통해서 인증서를 구입해야 함


#### SSL 인증서의 내용
1. 서비스의 정보    (인증서를 발급한 CA, 서비스의 도메인 등)
2. 서버 측 공개키   (공개키의 내용, 공개키의 암호화 방법)

* 1번은 클라이언트가 접속한 서버가 클라이언트가 의도한 서버가 맞는지에 대한 내용
* 2번은 서버와 통신을 할 때 사용할 공개키와 그 공개키의 암호화 방법들에 대한 정보
* 서비스의 도메인, 공개키와 같은 정보는 서비스가 CA로부터 인증서를 구입할 때 제출


#### SSL의 동작방법

* 클라이언트 <--> 서버가 주고받는 실제 정보는 대칭키 방식으로 암호화
* 대칭키 방식으로 암호화된 실제 정보를 복호화할 때 사용할 대칭키는 공개키 방식으로 암호화
* 즉 아래와 같음
    * 실제 데이터 : 대칭키
    * 대칭키의 키 : 공개키








## 악수 (handshake)
* 사람 간 악수는 인사를 통해 상대의 기분과 상황을 상호탐색 하는 것이다.
* 마찬가지로 클라이언트와 서버도 실제 데이터를 주고받기 전 일종의 악수를 한다.
* 이 단계에서는 서로 상대방의 존재여부, 데이터 통신 방법 여부등을 파악하게 된다.
* 컴퓨터와 컴퓨터가 네트워크를 이용해서 통신을 할 때는 내부적으로 다음 단계를 거침
    1. 악수
    2. 전송
    3. 세션종료


#### SSL 방식의 핸드쉐이크
* SSL 방식을 이용해서 통신을 하는 브라우저와 서버가 핸드쉐이크를 할 때 SSL 인증서를 이용

#### 클라이언트와 서버가 통신하는 과정
1. 클라이언트가 서버에 접속. 이 단계를 Client Hello라고 하고, 아래 정보를 주고받는다.
    - 클라이언트 측에서 생성한 랜덤 데이터
    - 클라이언트가 지원하는 암호화 방식
    - 세션ID

2. 서버는 Client Hello에 대한 응답으로 Server Hello를 함
    - 서버 측에서 생성한 랜덤 데이터
    - 서버가 선택한 클라이언트의 암호화 방식
    - 인증서

3. 클라이언트는 내장된 CA 리스트와 대조해서 서버의 인증서가 CA에 의해서 발급된 것인지를 확인
    - CA에서 발급한 인증서인지 확인하기 위해 클라이언트 내장 공개키로 인증서를 복호화
    - 클라이언트는 1, 2번 과정에서 생성한 랜덤 데이터를 조합해 대칭키 방식으로 pre master secret이라는 키를 생성
    - 생성된 키를 공개키 방식으로 안전하게 전송
    - 리스트에 인증서가 없다면 사용자에게 경고메시지 출력

4. 서버는 클라이언트가 전송한 pre master secret 값을 자신의 비공개키로 복호화
    - 서버와 클라이언트가 모두 pre master secret 값을 공유하게 됨
    - 공유한 secret 값을 master secret 값으로 만들고 이걸 이용해 session key 값 생성
    - session key는 서버와 클라이언트가 데이터를 대칭키 방식으로 암호화 하고 주고받는 데 이용됨

5. 클라이언트-서버는 서로 핸드쉐이크 종료를 알림

* 세션 : 실제로 서버와 클라이언트가 데이터를 주고받는 단계
    - 상대방에게 전송하기 전 session key 값을 이용해 대칭키 방식으로 암호화

* 세션 종료 : 데이터의 전송이 끝난 뒤 서로에게 SSL 통신이 끝났음을 알림
    - 통신이 종료되면 대칭키인 세션키를 폐기
