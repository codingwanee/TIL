# 하이브
- 하이브는 하둡 에코시스템에서 많이 사용되는 데이터 웨어하우징용 솔루션
- SQL과 유사한 HiveQL 쿼리를 이용하여 데이터를 조회하는 방법을 제공

## Hive 구성요소
- UI
    - 사용자가 쿼리 및 기타 작업을 시스템에 제출하는 사용자 인터페이스
    - CLI, Beeline, JDBC 등
- Driver
    - 쿼리를 입력받고 작업을 처리
    - 사용자 세션을 구현하고, JDBC/ODBC 인터페이스 API 제공
- Compiler
    - 메타스토어를 참고하여 쿼리 구문을 분석하고 실행계획을 생성
- Metastore
    - 디비, 테이블, 파티션의 정보를 저장
- Execution Engine
    - 컴파일러에 의해 생성된 실행계획을 실행

## 하이브 실행 순서
1. 사용자가 제출한 SQL문을 드라이버가 컴파일러에 요청하여 메타스토어의 정보를 이용해 처리에 적합한 형태로 컴파일 -- hive
2. 컴파일된 SQL을 실행엔진으로 실행 -- hive
3. 리소스 매니저가 클러스터의 자원을 적절히 활용하여 실행 -- hadoop
4. 실행 중 사용하는 원천데이터는 HDFS등의 저장장치를 이용 -- hadoop
5. 실행결과를 사용자에게 반환

## 하이브 버전별 특징

#### Hive 1.0
- 2012년 0.10 버전을 시작으로, 201년 1.0 버전 정식 발표
- SQL을 이용한 맵리듀스 처리
- 파일 데이터의 논리적 표현
- 빅데이터의 배치 처리를 목표

#### Hive 2.0
- 2016년 2.0 버전 발표
- 기본 실행 엔진이 TEZ로 변경
- LLAP(Live Long and Process) 구조 추가
- Spark 지원 강화
- CBO 강화

#### Hive 3.0
- 2018년 3.0 버전 발표
- 맵리듀스 엔진, 하이브 CLI 제거
- TEZ엔진과 비라인을 이용해 작업을 처리하도록 수정
- 롤을 이용한 작업상태 관리 (workload management)
- 트랜잭션 처리 강화
- 구체화 뷰(materialized view) 추가
- 쿼리 결과를 캐싱하여 더 빠른속도로 작업 가능

#### LLAP; Live Long and Process
- Hive 2.0에 도입
- 작업을 실행한 데몬을 계속 유지하여, 핫 데이터를 캐싱할 수 있는 기능
- MR, TEZ같이 실제 작업을 처리하는 엔진이 아니라 작업을 도와주는 보조도구이며, HDFS처럼 데이터를 영구히 저장하지도 않음


## 하이브 서비스

#### 메타스토어
- HDFS 데이터 구조를 저장하는 실제 데이터베이스를 가지고 있음
- 3가지 실행모드로 동작
    1. 임베디드 Embeded
        - 별도의 데이터베이스를 구성하지 않고 더비DB를 이용한 모드
        - 주로 테스트로 동작할 때 사용하는 모드
    2. 로컬 Local
        - 별도의 데이터베이스를 가지고 있지만, 하이브 드라이버와 같은 JVM에서 동작
    3. 리모트 Remote
        - 별도의 데이터베이스를 가지고, 별도의 JVM에서 단독으로 동작하는 모드
        - 리모트로 동작하는 하이브 메타스토어를 HCat 서버라고도 함\
        - 실 운영에서 주로 사용하는 모드

#### 메타 데이터베이스
- 하이브 테이블들에 대한 논리적인 정보는 데이터베이스에 저장되고, 메타스토어 서비스는 이 데이터베이스 정보를 여러 클라이언트에게 제공
- 더비, MSSQL, MySQL, 오라클 등의 데이터베이스 지원

#### 하이브 데이터베이스
- 하이브의 데이터베이스는 테이블의 이름을 구별하기 위한 네임 스페이스 역할
- 각 테이블의 데이터의 기본 저장 위치를 제공
- 데이터베이스를 생성할 때 로케이션을 지정하지 않으면 설정값을 기본위치로 설정
- 데이터베이스의 로케이션은 테이블이 로케이션을 지정하지 않았을 때 기본 저장 위치가 됨

#### 하이브 테이블
- 하이브에서 테이블이란 HDFS상에 저장된 파일과 디렉토리 구조에 대한 메타 정보라고 할 수 있음
- LOCATION: 테이블에 쓰는 데이터의 저장위치
- 테이블 타입
    - MANAGED: 세션이 종료되어도 테이블의 데이터와 파일 유지
    - EXTERNAL: 매니지드 테이블과 거의 동일하지만, 테이블을 DROP해도 파일은 그대로 유지
    - TEMPORARY: 현재 세션에서만 사용하는 테이블을 생성. 세션이 종료되면 제거되는 임시 테이블

#### 파티션
- 파티션은 폴더 구조로 데이터를 분할하여 저장
- **PARTITIONED BY**에 지정한 컬럼의 정보를 이용하여 폴더 단위로 데이터 생성

#### 하이브의 함수
- 내장함수
- UDF (User Defined Function)

#### 하이브서버2 hiveserver2
- 다른 언어로 개발된 클라이언트와 연동 서비스를 제공
- 하이브서버1을 개선하여 다중 사용자 동시성, 인증기능 등을 지원
- JDBC, ODBC, thrift를 사용하는 애플리케이션과 통신하여 하이브 연산을 수행하고 결과를 반환

#### 비라인 beeline
- SQLLine 기반으로 된, 하이브서버2(hiveserver2)에 접속하여 쿼리를 실행하기 위한 도구
- JDBC를 사용하여 하이브서버2에 접속
